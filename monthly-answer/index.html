<!DOCTYPE html PUBLIC "-//WAPFORUM//DTD XHTML Mobile 1.0//EN" "http://www.wapforum.org/DTD/xhtml-mobile10.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8">

    <!-- Always force latest IE rendering engine or request Chrome Frame -->
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Use title if it's in the page YAML frontmatter -->
    <script src="http://code.jquery.com/jquery-2.1.4.min.js"></script>
    <script src="http://code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
    <link href="../stylesheets/normalize.css" rel="stylesheet" type="text/css" /><link href="../stylesheets/all.css" rel="stylesheet" type="text/css" /><link href="../stylesheets/slick.css" rel="stylesheet" type="text/css" /><link href="../stylesheets/slick-theme.css" rel="stylesheet" type="text/css" />
    <script src="../javascripts/all.js" type="text/javascript"></script><script src="../javascripts/script.js" type="text/javascript"></script><script src="../javascripts/slick.min.js" type="text/javascript"></script>
    <script type="text/javascript" src="http://momentjs.com/downloads/moment.js"></script>


    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>

  </head>

  <body class="monthly-answer monthly-answer_index">
    <!-- <div id="brim-mask"> <script src="../javascripts/scream.js"></script>
    <script src="../javascripts/brim.js"></script>-->
        <!-- Content displayed to the user when in full view. -->
    <!-- </div> -->
    <!-- <div id="brim-main"> -->
        <!-- Content displayed to the user when in minimal view.  -->
    <!-- </div> -->
    <script>
  $(document).ready(function() {
    var all_images = ['1_Bending_M', '2_Standing_up_from_couch_F', '3_Standing_up_M', '4_Running_F', '5_Walking_a_M', '6_Steep_Walking_F', '7_Walking_b_M', '8_Carring_upstair_M', '9_Downstair_M', '10_Upstair_M', '11_Uneven_surface_F', '12_Light_housework_F', '13_Moving_up_in_bed_F', '14_Getting_in_a_car_M', '15_Mopping_F', '16_Bending_M', '17_Biking_M', '18_Carring_downstair_M', '19_Commuting_a', '20_Commuting_b', '21_Cooking_F', '22_Dog_walking_F', '23_Dog_walking_M', '24_Going_shopping', '25_Going_shopping_F', '26_Going shopping_M', '27_Holding_cup_M', '28_Lifting_M', '29_Opening_bottle_M', '30_Opening_door', '31_Opening_jar', '32_Printing_M', '33_Reading_M', '34_Sleeping', '35_Socilizing_a', '36_Socilizing_b', '37_Standing', '38_Standing_working_M', '39_Taking_Bath', '40_Taking_off_Socks', '41_Typing_a', '42_Typing_b', '43_Waiting_for_subway', '44_Walking', '45_Washing_hand_M', '46_Zipping'];
  
    var image_names = [];
    var image_info = window.location.hash.substr(13);
    console.log(image_info);
    var image_index = image_info.substr(0, image_info.indexOf('&'));
    console.log(image_index);
    var user_id = image_info.split("&").pop().substr(8);
    console.log(user_id);
  
    if (image_index.length !== 0 ){
      var image_arr = image_index.split(',');
      $.each(image_arr, function(index, value) {
        image_names.push(all_images[Number(value - 1)]);
      });
  
      $.each(image_names, function(index, value) {
        $('.activities-bottom').append('<div class="col-xs-4 monthly-image" id="'+ value +'"></div>');
        $('#'+ value).append('<img class="img-responsive" src="../images/survey-images/' + value +'.jpg" >');
        $('#'+ value).append('<center class="overlay"></center>');
        $('#'+ value + ' .overlay').append('<img src="../images/logo/yadl-blue-check.png">');
      });
    }
  
  
  
    var add_event;
    var event_names = [];
  
    $('#addition_event').on('keyup', function() {
      add_event = this.value;
    });
  
    $('#add-addon').click(function() {
      var add_event_id = add_event.replace(/\s+/g, '-').toLowerCase();
      $('.activities-bottom').prepend('<div class="col-xs-4 monthly-image" id="'+ add_event_id +'"></div>');
      $('#'+ add_event_id).append('<img class="img-responsive" src="../images/logo/yadl-background.png" >');
      $('#'+ add_event_id).append('<p>' + add_event + '</p>');
      $('#'+ add_event_id).append('<center class="overlay"></center>');
      $('#'+ add_event_id + ' .overlay').append('<img src="../images/logo/yadl-blue-check.png">');
      event_names.push(add_event);
      console.log(event_names);
      console.log(json_hard_activities);
      $('#addition_event').val("");
    });
  
    var json_hard_activities;
    var token;
    var ohmage_dsu = "https://ohmage-omh.smalldata.io/dsu/";
  
    $('.submit-button').click(function(){
      json_hard_activities = {
        "header": {
          "creation_date_time": moment().format(),
          "schema_id": {
            "namespace": "omh",
            "name": "yadl-survey",
            "description": "hard activities",
            "version": "1.0"
          },
          "acquisition_provenance": {
            "source_name": "YADL",
            "modality": "self-reported"
          }
        },
        "body": {
          "activity_image": image_names,
          "activity_names": event_names
        }
      };
  
      $.ajax({
        type: "POST",
        url: ohmage_dsu + "dataPoints",
        headers: {
          "Authorization": "Bearer " + '543250de-ba15-4619-a4b4-7ec6bc827cbd'
        },
        data: JSON.stringify({HardActivities: json_hard_activities}),
        contentType: "application/json",
        dataType: "json",
        success: function(data) {
          console.log(data);
          window.location.href = dsu + "thank_you_page";
        },
        error: function() {
          console.log('Not posting the data');
          console.log(json_hard_activities);
          window.location.href = dsu + "thank_you_page";
        }
      });
    });
  });
</script>
<center class='activities-top'>
  <h3 style='font-weight: 300;'>Your hard activities:</h3>
  <div class='add-activity-button'>
    <div class='input-group input-group-lg'>
      <input aria-describedby='add-addon' class='form-control' id='addition_event' placeholder='More hard activities here...' type='text'>
      <span class='input-group-addon' id='add-addon' style='background: rgb(3, 122, 255); color: white;'>
        Add
      </span>
    </div>
  </div>
  <div id='image_array_numbers'></div>
</center>
<div class='row activities-bottom'></div>
<a class='submit-button'>
  <p>Submit</p>
</a>

  </body>

  <script type="text/javascript">
    // window.addEventListener('DOMContentLoaded', function () {
    //     var scream,
    //         brim;

    //     scream = gajus.Scream({
    //         width: {
    //             portrait: 320,
    //             landscape: 640
    //         }
    //     });

    //     brim = gajus.Brim({
    //         viewport: scream
    //     });
    // });
    // $(document).ready(function() {

    //   var token = url("#access_token");
    //   var dsu = 'https://ohmage-omh.smalldata.io/dsu/'

    //   if(!token)
    //   {
    //       window.location.href = dsu + "oauth/authorize?client_id=mobility-visualization&response_type=token";
    //   }
    //   else
    //   {
    //       $.getJSON(dsu + "oauth/check_token?token=" + token)
    //       .done(function(data) {
    //           console.log("Get the token!");
    //       })
    //       .fail(function() {
    //           window.location.href = dsu + "oauth/authorize?client_id=mobility_visualization&response_type=token";
    //       });
    //   }
    // });

</script>
</html>
